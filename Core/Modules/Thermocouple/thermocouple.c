#include "main.h"
#include "thermocouple.h"
#include <stdio.h>
#include <string.h>

uint16_t Theoretical_Calibraton[] = {21,26,30,35,40,44,49,54,58,63,68,68,72,77,82,86,91,96,101,105,110,115,115,120,125,129,134,139,144,149,154,158,163,168,173,178,183,188,193,198,203,208,213,213,217,222,227,232,237,242,247,252,257,262,262,267,272,277,282,287,292,297,302,308,313,313,318,323,328,333,338,343,348,353,358,363,363,368,374,379,384,389,394,399,404,409,415,415,420,425,430,435,440,445,451,456,461,466,466,471,476,482,487,492,497,502,508,513,518,518,523,528,533,539,544,549,554,559,565,570,570,575,580,585,591,596,601,606,612,617,622,622,627,632,638,643,648,653,658,664,669,674,674,679,684,690,695,700,705,710,715,721,726,726,731,736,741,747,752,757,762,767,772,778,778,783,788,793,798,803,809,814,819,824,829,829,834,839,845,850,855,860,865,870,875,880,880,885,891,896,901,906,911,916,921,926,931,931,936,941,946,951,957,962,967,972,977,982,982,987,992,997,1002,1007,1012,1017,1022,1027,1032,1032,1037,1042,1047,1052,1057,1062,1067,1072,1077,1082,1082,1087,1092,1097,1102,1107,1112,1117,1122,1127,1132,1132,1137,1142,1147,1152,1158,1162,1167,1172,1177,1182,1182,1187,1192,1197,1202,1208,1213,1218,1223,1228,1232,1232,1237,1242,1247,1253,1258,1263,1268,1273,1278,1283,1283,1288,1293,1298,1303,1308,1313,1318,1323,1328,1333,1333,1338,1343,1348,1353,1358,1363,1368,1373,1378,1383,1383,1388,1394,1399,1404,1409,1414,1419,1424,1429,1434,1434,1439,1444,1449,1454,1460,1465,1470,1475,1480,1485,1485,1490,1495,1500,1505,1511,1516,1521,1526,1531,1536,1536,1541,1546,1552,1557,1562,1567,1572,1577,1582,1588,1588,1593,1598,1603,1608,1613,1618,1624,1629,1634,1639,1639,1644,1649,1655,1660,1665,1670,1675,1680,1686,1691,1691,1696,1701,1706,1711,1717,1722,1727,1732,1737,1743,1743,1748,1753,1758,1763,1769,1774,1779,1784,1789,1795,1795,1800,1805,1810,1815,1821,1826,1831,1836,1842,1847,1847,1852,1857,1862,1868,1873,1878,1883,1889,1894,1899,1899,1904,1909,1915,1920,1925,1930,1936,1941,1946,1951,1951,1957,1962,1967,1972,1978,1983,1988,1993,1999,2004};

float M1 = 1.264368;
float B1 = 14.66667;
float M2 = 0.674153;
float B2 = 151.5955;
float M3 = 0.874459;
float B3 = 87.2987;

float M = 0.914005;
float B = 65.46929;

uint16_t Low_Cutoff = 232;
uint16_t Middle_Cutoff = 321;
uint16_t High_Cutoff = 552;

float Convert_CtoF(uint16_t Temp_in_C){
    float factor = (5/9);
    float temp = (float)Temp_in_C;
    return((float)((temp*factor)+32.0));
}

uint16_t Calculate_Temp_inC(uint16_t ADC_Value){
	float y;

//Sad attempt at using multiple points, but it was not even close :(

	/*if(ADC_Value < Low_Cutoff){
		y = M1*(float)ADC_Value + B1;
		int i = 0;
		while(Theoretical_Calibraton[i]<(uint16_t)y){
			i++;
		}
		return(i-40);
	}
	else if (ADC_Value < Middle_Cutoff){
		y = M2*(float)ADC_Value + B2;
		int i = 64;
		while(Theoretical_Calibraton[i]<(uint16_t)y){
			i++;
		}
		return(i-40);
	}
	else{
		y = M2*(float)ADC_Value + B2;
		int i = 77;
		while(Theoretical_Calibraton[i]<(uint16_t)y){
			i++;
		}
		return(i-40);
	}*/

//2 point calibration was much much better

		y = M*(float)ADC_Value + B;
		int i = 0;
		while(Theoretical_Calibraton[i]<(uint16_t)y){
			i++;
		}
		return(i-40);
}